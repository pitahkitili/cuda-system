<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CUDA Security & Logistics - Complete System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f7fafc;
            border-bottom: 2px solid #e2e8f0;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f7fafc;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #edf2f7;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
        }

        .stat-card.green {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .stat-card.orange {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card.blue {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stat-card.purple {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-info {
            background: #3498db;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        table thead {
            background: #f7fafc;
        }

        table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        table tbody tr:hover {
            background: #f7fafc;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-pending {
            background: #fef5e7;
            color: #f39c12;
        }

        .badge-assigned {
            background: #e8f4fd;
            color: #3498db;
        }

        .badge-active {
            background: #d5f4e6;
            color: #27ae60;
        }

        .badge-completed {
            background: #e8e8e8;
            color: #555;
        }

        .badge-available {
            background: #d5f4e6;
            color: #27ae60;
        }

        .badge-in-use {
            background: #e8f4fd;
            color: #3498db;
        }

        .badge-maintenance {
            background: #fef5e7;
            color: #f39c12;
        }

        .badge-paid {
            background: #d5f4e6;
            color: #27ae60;
        }

        .badge-unpaid {
            background: #ffe5e5;
            color: #e74c3c;
        }

        .badge-partial {
            background: #fef5e7;
            color: #f39c12;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .success-message {
            background: #d5f4e6;
            color: #27ae60;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f7fafc;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
        }

        .info-value {
            color: #2d3748;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                font-size: 12px;
                padding: 15px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöõ CUDA Security & Logistics</h1>
            <p>Integrated Management System v1.1</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('new-request')">‚ûï New Request</button>
            <button class="nav-tab" onclick="showTab('all-requests')">üìã All Requests</button>
            <button class="nav-tab" onclick="showTab('fleet')">üöó Fleet</button>
            <button class="nav-tab" onclick="showTab('staff')">üë• Staff</button>
            <button class="nav-tab" onclick="showTab('reports')">üìà Reports</button>
            <button class="nav-tab" onclick="showTab('billing')">üí∞ Billing</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Today's Overview</h2>
            <div class="dashboard-grid">
                <div class="stat-card purple">
                    <h3>Total Requests Today</h3>
                    <div class="number" id="stat-total">0</div>
                </div>
                <div class="stat-card orange">
                    <h3>Pending Assignment</h3>
                    <div class="number" id="stat-pending">0</div>
                </div>
                <div class="stat-card blue">
                    <h3>Active Jobs</h3>
                    <div class="number" id="stat-active">0</div>
                </div>
                <div class="stat-card green">
                    <h3>Completed Today</h3>
                    <div class="number" id="stat-completed">0</div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="stat-card green">
                    <h3>Available Vehicles</h3>
                    <div class="number" id="stat-vehicles-available">0</div>
                </div>
                <div class="stat-card blue">
                    <h3>Vehicles In Use</h3>
                    <div class="number" id="stat-vehicles-active">0</div>
                </div>
                <div class="stat-card purple">
                    <h3>Available Staff</h3>
                    <div class="number" id="stat-staff-available">0</div>
                </div>
                <div class="stat-card orange">
                    <h3>Unpaid Invoices</h3>
                    <div class="number" id="stat-unpaid">0</div>
                </div>
            </div>

            <h3 style="margin: 30px 0 15px; color: #2d3748;">Recent Activity</h3>
            <div class="table-container" id="recent-activity">
                <div class="empty-state">
                    <p>No activity yet. Start by creating a new request.</p>
                </div>
            </div>
        </div>

        <!-- New Request Tab -->
        <div id="new-request" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Create New Service Request</h2>
            <div class="success-message" id="success-message">
                ‚úì Request created successfully!
            </div>
            <form id="request-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Client Name *</label>
                        <input type="text" id="client-name" required placeholder="Enter client name">
                    </div>
                    <div class="form-group">
                        <label>Client Phone *</label>
                        <input type="tel" id="client-phone" required placeholder="e.g., 0712345678">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Service Type *</label>
                        <select id="service-type" required>
                            <option value="">Select service type</option>
                            <option value="delivery">Delivery / Courier</option>
                            <option value="security">Security Guard</option>
                            <option value="transport">Staff Transport</option>
                            <option value="pickup">Pickup Service</option>
                            <option value="escort">Security Escort</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Priority *</label>
                        <select id="priority" required>
                            <option value="">Select priority</option>
                            <option value="urgent">Urgent</option>
                            <option value="high">High</option>
                            <option value="normal">Normal</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Pickup Location *</label>
                        <input type="text" id="pickup-location" required placeholder="Enter pickup address">
                    </div>
                    <div class="form-group">
                        <label>Delivery Location *</label>
                        <input type="text" id="delivery-location" required placeholder="Enter delivery address">
                    </div>
                </div>

                <div class="form-group">
                    <label>Service Details</label>
                    <textarea id="service-details" placeholder="Additional details about the service request..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Scheduled Date *</label>
                        <input type="date" id="scheduled-date" required>
                    </div>
                    <div class="form-group">
                        <label>Scheduled Time *</label>
                        <input type="time" id="scheduled-time" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Service Cost (KES) *</label>
                    <input type="number" id="service-cost" required placeholder="Enter service cost" min="0">
                </div>

                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary">Create Request</button>
                    <button type="reset" class="btn btn-secondary">Clear Form</button>
                </div>
            </form>
        </div>

        <!-- All Requests Tab -->
        <div id="all-requests" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #2d3748;">All Service Requests</h2>
                <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
            </div>
            <div id="all-requests-list">
                <div class="empty-state">
                    <p>No requests yet. Create your first request to get started.</p>
                </div>
            </div>
        </div>

        <!-- Fleet Management Tab -->
        <div id="fleet" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Fleet Management</h2>
            
            <div style="margin-bottom: 30px;">
                <button class="btn btn-primary" onclick="showAddVehicleForm()">+ Add New Vehicle</button>
            </div>

            <div id="add-vehicle-form" style="display: none; margin-bottom: 30px;">
                <div class="card">
                    <h3>Add New Vehicle</h3>
                    <form id="vehicle-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Vehicle Type *</label>
                                <select id="vehicle-type" required>
                                    <option value="">Select type</option>
                                    <option value="car">Car</option>
                                    <option value="van">Van</option>
                                    <option value="motorbike">Motorbike</option>
                                    <option value="truck">Truck</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Registration Number *</label>
                                <input type="text" id="vehicle-reg" required placeholder="e.g., KCA 123A">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Make/Model *</label>
                                <input type="text" id="vehicle-model" required placeholder="e.g., Toyota Hilux">
                            </div>
                            <div class="form-group">
                                <label>Year</label>
                                <input type="number" id="vehicle-year" placeholder="e.g., 2020" min="1990" max="2030">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Fuel Capacity (Liters)</label>
                                <input type="number" id="vehicle-fuel-capacity" placeholder="e.g., 50" min="0">
                            </div>
                            <div class="form-group">
                                <label>Current Mileage (KM)</label>
                                <input type="number" id="vehicle-mileage" placeholder="e.g., 50000" min="0">
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px;">
                            <button type="submit" class="btn btn-primary">Add Vehicle</button>
                            <button type="button" class="btn btn-secondary" onclick="hideAddVehicleForm()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="fleet-list">
                <div class="empty-state">
                    <p>No vehicles registered yet. Add your first vehicle to get started.</p>
                </div>
            </div>
        </div>

        <!-- Staff Management Tab -->
        <div id="staff" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Staff Management</h2>
            
            <div style="margin-bottom: 30px;">
                <button class="btn btn-primary" onclick="showAddStaffForm()">+ Add New Staff</button>
            </div>

            <div id="add-staff-form" style="display: none; margin-bottom: 30px;">
                <div class="card">
                    <h3>Add New Staff Member</h3>
                    <form id="staff-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Full Name *</label>
                                <input type="text" id="staff-name" required placeholder="Enter full name">
                            </div>
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" id="staff-phone" required placeholder="e.g., 0712345678">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Role *</label>
                                <select id="staff-role" required>
                                    <option value="">Select role</option>
                                    <option value="rider">Rider</option>
                                    <option value="driver">Driver</option>
                                    <option value="guard">Security Guard</option>
                                    <option value="supervisor">Supervisor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ID Number *</label>
                                <input type="text" id="staff-id-number" required placeholder="National ID">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>License Number (if applicable)</label>
                                <input type="text" id="staff-license" placeholder="License number">
                            </div>
                            <div class="form-group">
                                <label>Date of Joining</label>
                                <input type="date" id="staff-join-date">
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px;">
                            <button type="submit" class="btn btn-primary">Add Staff</button>
                            <button type="button" class="btn btn-secondary" onclick="hideAddStaffForm()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="staff-list">
                <div class="empty-state">
                    <p>No staff registered yet. Add your first staff member to get started.</p>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Reports & Analytics</h2>
            
            <div class="form-row" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label>Report Type</label>
                    <select id="report-type" onchange="generateReport()">
                        <option value="daily">Daily Summary</option>
                        <option value="weekly">Weekly Summary</option>
                        <option value="monthly">Monthly Summary</option>
                        <option value="revenue">Revenue Report</option>
                        <option value="fleet">Fleet Usage Report</option>
                        <option value="staff">Staff Performance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date Range</label>
                    <input type="date" id="report-date" onchange="generateReport()">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Print Report</button>
                <button class="btn btn-secondary" onclick="exportReport()">üì• Export CSV</button>
            </div>

            <div id="report-container">
                <div class="empty-state">
                    <p>Select a report type to generate analytics.</p>
                </div>
            </div>
        </div>

        <!-- Billing Tab -->
        <div id="billing" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Billing & Invoices</h2>
            
            <div class="dashboard-grid" style="margin-bottom: 30px;">
                <div class="stat-card green">
                    <h3>Total Revenue (Month)</h3>
                    <div class="number" id="revenue-total">0</div>
                </div>
                <div class="stat-card blue">
                    <h3>Paid Invoices</h3>
                    <div class="number" id="invoices-paid">0</div>
                </div>
                <div class="stat-card orange">
                    <h3>Pending Payment</h3>
                    <div class="number" id="invoices-pending">0</div>
                </div>
                <div class="stat-card purple">
                    <h3>Outstanding Amount</h3>
                    <div class="number" id="amount-outstanding">0</div>
                </div>
            </div>

            <div id="billing-list">
                <div class="empty-state">
                    <p>No invoices yet. Complete service requests to generate invoices.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let requests = [];
        let vehicles = [];
        let staff = [];
        let requestIdCounter = 1001;
        let vehicleIdCounter = 1;
        let staffIdCounter = 1;

        // Initialize
        loadData();
        updateDashboard();
        setDefaultDates();

        function setDefaultDates() {
            document.getElementById('scheduled-date').valueAsDate = new Date();
            document.getElementById('report-date').valueAsDate = new Date();
        }

        function loadData() {
            const savedRequests = localStorage.getItem('cuda_requests');
            const savedVehicles = localStorage.getItem('cuda_vehicles');
            const savedStaff = localStorage.getItem('cuda_staff');
            
            if (savedRequests) {
                requests = JSON.parse(savedRequests);
                requestIdCounter = Math.max(...requests.map(r => parseInt(r.id.substring(4))), 1000) + 1;
            }
            if (savedVehicles) {
                vehicles = JSON.parse(savedVehicles);
                vehicleIdCounter = Math.max(...vehicles.map(v => parseInt(v.id.substring(3))), 0) + 1;
            }
            if (savedStaff) {
                staff = JSON.parse(savedStaff);
                staffIdCounter = Math.max(...staff.map(s => parseInt(s.id.substring(4))), 0) + 1;
            }
        }

        function saveData() {
            localStorage.setItem('cuda_requests', JSON.stringify(requests));
            localStorage.setItem('cuda_vehicles', JSON.stringify(vehicles));
            localStorage.setItem('cuda_staff', JSON.stringify(staff));
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') updateDashboard();
            else if (tabName === 'all-requests') displayAllRequests();
            else if (tabName === 'fleet') displayFleet();
            else if (tabName === 'staff') displayStaff();
            else if (tabName === 'reports') generateReport();
            else if (tabName === 'billing') displayBilling();
        }

        // Request Form
        document.getElementById('request-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const request = {
                id: 'REQ-' + requestIdCounter++,
                clientName: document.getElementById('client-name').value,
                clientPhone: document.getElementById('client-phone').value,
                serviceType: document.getElementById('service-type').value,
                priority: document.getElementById('priority').value,
                pickupLocation: document.getElementById('pickup-location').value,
                deliveryLocation: document.getElementById('delivery-location').value,
                serviceDetails: document.getElementById('service-details').value,
                scheduledDate: document.getElementById('scheduled-date').value,
                scheduledTime: document.getElementById('scheduled-time').value,
                serviceCost: parseFloat(document.getElementById('service-cost').value),
                status: 'pending',
                createdAt: new Date().toISOString(),
                assignedTo: null,
                assignedVehicle: null,
                completedAt: null,
                invoiceStatus: 'unpaid'
            };

            requests.push(request);
            saveData();

            document.getElementById('success-message').style.display = 'block';
            setTimeout(() => {
                document.getElementById('success-message').style.display = 'none';
            }, 3000);

            this.reset();
            setDefaultDates();
            updateDashboard();
        });

        // Vehicle Form
        function showAddVehicleForm() {
            document.getElementById('add-vehicle-form').style.display = 'block';
        }

        function hideAddVehicleForm() {
            document.getElementById('add-vehicle-form').style.display = 'none';
            document.getElementById('vehicle-form').reset();
        }

        document.getElementById('vehicle-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const vehicle = {
                id: 'VEH-' + vehicleIdCounter++,
                type: document.getElementById('vehicle-type').value,
                registration: document.getElementById('vehicle-reg').value,
                model: document.getElementById('vehicle-model').value,
                year: document.getElementById('vehicle-year').value,
                fuelCapacity: document.getElementById('vehicle-fuel-capacity').value,
                mileage: document.getElementById('vehicle-mileage').value,
                status: 'available',
                addedAt: new Date().toISOString()
            };

            vehicles.push(vehicle);
            saveData();
            hideAddVehicleForm();
            displayFleet();
            updateDashboard();
        });

        // Staff Form
        function showAddStaffForm() {
            document.getElementById('add-staff-form').style.display = 'block';
        }

        function hideAddStaffForm() {
            document.getElementById('add-staff-form').style.display = 'none';
            document.getElementById('staff-form').reset();
        }

        document.getElementById('staff-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const staffMember = {
                id: 'STAFF-' + staffIdCounter++,
                name: document.getElementById('staff-name').value,
                phone: document.getElementById('staff-phone').value,
                role: document.getElementById('staff-role').value,
                idNumber: document.getElementById('staff-id-number').value,
                license: document.getElementById('staff-license').value,
                joinDate: document.getElementById('staff-join-date').value,
                status: 'available',
                addedAt: new Date().toISOString()
            };

            staff.push(staffMember);
            saveData();
            hideAddStaffForm();
            displayStaff();
            updateDashboard();
        });

        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            
            const todayRequests = requests.filter(r => r.scheduledDate === today);
            const pending = requests.filter(r => r.status === 'pending').length;
            const active = requests.filter(r => r.status === 'active' || r.status === 'assigned').length;
            const completed = todayRequests.filter(r => r.status === 'completed').length;

            const availableVehicles = vehicles.filter(v => v.status === 'available').length;
            const activeVehicles = vehicles.filter(v => v.status === 'in-use').length;
            const availableStaff = staff.filter(s => s.status === 'available').length;
            const unpaidInvoices = requests.filter(r => r.invoiceStatus === 'unpaid' && r.status === 'completed').length;

            document.getElementById('stat-total').textContent = todayRequests.length;
            document.getElementById('stat-pending').textContent = pending;
            document.getElementById('stat-active').textContent = active;
            document.getElementById('stat-completed').textContent = completed;
            document.getElementById('stat-vehicles-available').textContent = availableVehicles;
            document.getElementById('stat-vehicles-active').textContent = activeVehicles;
            document.getElementById('stat-staff-available').textContent = availableStaff;
            document.getElementById('stat-unpaid').textContent = unpaidInvoices;

            displayRecentActivity();
        }

        function displayRecentActivity() {
            const container = document.getElementById('recent-activity');
            const recent = requests.slice(-5).reverse();

            if (recent.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No activity yet. Start by creating a new request.</p></div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Request ID</th>
                            <th>Client</th>
                            <th>Service Type</th>
                            <th>Scheduled</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            recent.forEach(req => {
                html += `
                    <tr>
                        <td><strong>${req.id}</strong></td>
                        <td>${req.clientName}</td>
                        <td>${formatServiceType(req.serviceType)}</td>
                        <td>${req.scheduledDate} ${req.scheduledTime}</td>
                        <td><span class="badge badge-${req.status}">${req.status.toUpperCase()}</span></td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayAllRequests() {
            const container = document.getElementById('all-requests-list');

            if (requests.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No requests yet. Create your first request to get started.</p></div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Request ID</th>
                            <th>Client</th>
                            <th>Service</th>
                            <th>Priority</th>
                            <th>Scheduled</th>
                            <th>Assigned</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            requests.slice().reverse().forEach(req => {
                html += `
                    <tr>
                        <td><strong>${req.id}</strong></td>
                        <td>${req.clientName}<br><small>${req.clientPhone}</small></td>
                        <td>${formatServiceType(req.serviceType)}<br><small>KES ${req.serviceCost.toLocaleString()}</small></td>
                        <td>${req.priority.toUpperCase()}</td>
                        <td>${req.scheduledDate}<br><small>${req.scheduledTime}</small></td>
                        <td>${req.assignedTo || 'Unassigned'}<br><small>${req.assignedVehicle || ''}</small></td>
                        <td><span class="badge badge-${req.status}">${req.status.toUpperCase()}</span></td>
                        <td>
                            <div class="action-buttons">
                                ${req.status === 'pending' ? `<button class="btn btn-info btn-small" onclick="assignJob('${req.id}')">Assign</button>` : ''}
                                ${req.status === 'assigned' || req.status === 'active' ? `<button class="btn btn-success btn-small" onclick="completeJob('${req.id}')">Complete</button>` : ''}
                                ${req.status === 'completed' && req.invoiceStatus === 'unpaid' ? `<button class="btn btn-warning btn-small" onclick="markPaid('${req.id}')">Mark Paid</button>` : ''}
                                <button class="btn btn-danger btn-small" onclick="deleteRequest('${req.id}')">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayFleet() {
            const container = document.getElementById('fleet-list');

            if (vehicles.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No vehicles registered yet. Add your first vehicle to get started.</p></div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Vehicle ID</th>
                            <th>Type</th>
                            <th>Registration</th>
                            <th>Model</th>
                            <th>Status</th>
                            <th>Mileage (KM)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            vehicles.forEach(veh => {
                html += `
                    <tr>
                        <td><strong>${veh.id}</strong></td>
                        <td>${veh.type.toUpperCase()}</td>
                        <td>${veh.registration}</td>
                        <td>${veh.model}</td>
                        <td><span class="badge badge-${veh.status}">${veh.status.toUpperCase()}</span></td>
                        <td>${veh.mileage || 'N/A'}</td>
                        <td>
                            <button class="btn btn-info btn-small" onclick="viewVehicle('${veh.id}')">View</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayStaff() {
            const container = document.getElementById('staff-list');

            if (staff.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No staff registered yet. Add your first staff member to get started.</p></div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Staff ID</th>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Join Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            staff.forEach(s => {
                html += `
                    <tr>
                        <td><strong>${s.id}</strong></td>
                        <td>${s.name}</td>
                        <td>${s.role.toUpperCase()}</td>
                        <td>${s.phone}</td>
                        <td><span class="badge badge-${s.status}">${s.status.toUpperCase()}</span></td>
                        <td>${s.joinDate || 'N/A'}</td>
                        <td>
                            <button class="btn btn-info btn-small" onclick="viewStaff('${s.id}')">View</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayBilling() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthRequests = requests.filter(r => r.scheduledDate.startsWith(currentMonth) && r.status === 'completed');
            
            const totalRevenue = monthRequests.reduce((sum, r) => sum + r.serviceCost, 0);
            const paidCount = monthRequests.filter(r => r.invoiceStatus === 'paid').length;
            const unpaidCount = monthRequests.filter(r => r.invoiceStatus === 'unpaid').length;
            const outstandingAmount = monthRequests.filter(r => r.invoiceStatus === 'unpaid').reduce((sum, r) => sum + r.serviceCost, 0);

            document.getElementById('revenue-total').textContent = 'KES ' + totalRevenue.toLocaleString();
            document.getElementById('invoices-paid').textContent = paidCount;
            document.getElementById('invoices-pending').textContent = unpaidCount;
            document.getElementById('amount-outstanding').textContent = 'KES ' + outstandingAmount.toLocaleString();

            const container = document.getElementById('billing-list');
            const completedRequests = requests.filter(r => r.status === 'completed');

            if (completedRequests.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No invoices yet. Complete service requests to generate invoices.</p></div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Invoice ID</th>
                            <th>Client</th>
                            <th>Service</th>
                            <th>Amount</th>
                            <th>Completed</th>
                            <th>Payment Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            completedRequests.slice().reverse().forEach(req => {
                html += `
                    <tr>
                        <td><strong>${req.id}</strong></td>
                        <td>${req.clientName}<br><small>${req.clientPhone}</small></td>
                        <td>${formatServiceType(req.serviceType)}</td>
                        <td><strong>KES ${req.serviceCost.toLocaleString()}</strong></td>
                        <td>${req.completedAt ? new Date(req.completedAt).toLocaleDateString() : 'N/A'}</td>
                        <td><span class="badge badge-${req.invoiceStatus}">${req.invoiceStatus.toUpperCase()}</span></td>
                        <td>
                            ${req.invoiceStatus === 'unpaid' ? `<button class="btn btn-success btn-small" onclick="markPaid('${req.id}')">Mark Paid</button>` : ''}
                            <button class="btn btn-info btn-small" onclick="printInvoice('${req.id}')">Print</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function generateReport() {
            const reportType = document.getElementById('report-type').value;
            const container = document.getElementById('report-container');

            let html = '<div class="card">';
            html += `<h3>${reportType.toUpperCase().replace('-', ' ')} Report</h3>`;

            if (reportType === 'daily') {
                const today = new Date().toISOString().split('T')[0];
                const todayRequests = requests.filter(r => r.scheduledDate === today);
                const completed = todayRequests.filter(r => r.status === 'completed');
                const revenue = completed.reduce((sum, r) => sum + r.serviceCost, 0);

                html += `
                    <div class="info-row">
                        <span class="info-label">Total Requests:</span>
                        <span class="info-value">${todayRequests.length}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Completed:</span>
                        <span class="info-value">${completed.length}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Revenue:</span>
                        <span class="info-value">KES ${revenue.toLocaleString()}</span>
                    </div>
                `;
            } else if (reportType === 'revenue') {
                const totalRevenue = requests.filter(r => r.status === 'completed').reduce((sum, r) => sum + r.serviceCost, 0);
                const paidRevenue = requests.filter(r => r.invoiceStatus === 'paid').reduce((sum, r) => sum + r.serviceCost, 0);
                const unpaidRevenue = requests.filter(r => r.invoiceStatus === 'unpaid' && r.status === 'completed').reduce((sum, r) => sum + r.serviceCost, 0);

                html += `
                    <div class="info-row">
                        <span class="info-label">Total Revenue:</span>
                        <span class="info-value">KES ${totalRevenue.toLocaleString()}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Paid:</span>
                        <span class="info-value">KES ${paidRevenue.toLocaleString()}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Outstanding:</span>
                        <span class="info-value">KES ${unpaidRevenue.toLocaleString()}</span>
                    </div>
                `;
            } else if (reportType === 'fleet') {
                html += `
                    <div class="info-row">
                        <span class="info-label">Total Vehicles:</span>
                        <span class="info-value">${vehicles.length}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Available:</span>
                        <span class="info-value">${vehicles.filter(v => v.status === 'available').length}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">In Use:</span>
                        <span class="info-value">${vehicles.filter(v => v.status === 'in-use').length}</span>
                    </div>
                `;
            } else if (reportType === 'staff') {
                html += `
                    <div class="info-row">
                        <span class="info-label">Total Staff:</span>
                        <span class="info-value">${staff.length}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Available:</span>
                        <span class="info-value">${staff.filter(s => s.status === 'available').length}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">On Duty:</span>
                        <span class="info-value">${staff.filter(s => s.status === 'on-duty').length}</span>
                    </div>
                `;
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function assignJob(requestId) {
            const availableStaff = staff.filter(s => s.status === 'available');
            const availableVehicles = vehicles.filter(v => v.status === 'available');

            if (availableStaff.length === 0) {
                alert('No available staff members. Please add staff or wait for current assignments to complete.');
                return;
            }

            let staffOptions = '<select id="assign-staff-select">';
            availableStaff.forEach(s => {
                staffOptions += `<option value="${s.id}">${s.name} (${s.role})</option>`;
            });
            staffOptions += '</select>';

            let vehicleOptions = '<select id="assign-vehicle-select"><option value="">No vehicle</option>';
            availableVehicles.forEach(v => {
                vehicleOptions += `<option value="${v.id}">${v.registration} (${v.type})</option>`;
            });
            vehicleOptions += '</select>';

            const modal = confirm('Assign this job?\n\nNote: In the next version, you\'ll be able to select staff and vehicles from a dropdown.');

            if (modal) {
                const staffId = availableStaff[0].id;
                const vehicleId = availableVehicles.length > 0 ? availableVehicles[0].id : null;

                const request = requests.find(r => r.id === requestId);
                const staffMember = staff.find(s => s.id === staffId);
                const vehicle = vehicles.find(v => v.id === vehicleId);

                if (request && staffMember) {
                    request.status = 'assigned';
                    request.assignedTo = staffMember.name;
                    staffMember.status = 'on-duty';
                    
                    if (vehicle) {
                        request.assignedVehicle = vehicle.registration;
                        vehicle.status = 'in-use';
                    }

                    saveData();
                    alert('Job assigned successfully!');
                    displayAllRequests();
                    updateDashboard();
                }
            }
        }

        function completeJob(requestId) {
            if (confirm('Mark this job as completed?')) {
                const request = requests.find(r => r.id === requestId);
                if (request) {
                    request.status = 'completed';
                    request.completedAt = new Date().toISOString();

                    // Free up staff and vehicle
                    if (request.assignedTo) {
                        const staffMember = staff.find(s => s.name === request.assignedTo);
                        if (staffMember) staffMember.status = 'available';
                    }
                    if (request.assignedVehicle) {
                        const vehicle = vehicles.find(v => v.registration === request.assignedVehicle);
                        if (vehicle) vehicle.status = 'available';
                    }

                    saveData();
                    alert('Job marked as completed!');
                    displayAllRequests();
                    updateDashboard();
                }
            }
        }

        function markPaid(requestId) {
            if (confirm('Mark this invoice as paid?')) {
                const request = requests.find(r => r.id === requestId);
                if (request) {
                    request.invoiceStatus = 'paid';
                    saveData();
                    alert('Invoice marked as paid!');
                    displayBilling();
                    displayAllRequests();
                    updateDashboard();
                }
            }
        }

        function viewVehicle(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (vehicle) {
                alert(`Vehicle Details:\n\nID: ${vehicle.id}\nType: ${vehicle.type}\nRegistration: ${vehicle.registration}\nModel: ${vehicle.model}\nStatus: ${vehicle.status}`);
            }
        }

        function viewStaff(staffId) {
            const staffMember = staff.find(s => s.id === staffId);
            if (staffMember) {
                alert(`Staff Details:\n\nID: ${staffMember.id}\nName: ${staffMember.name}\nRole: ${staffMember.role}\nPhone: ${staffMember.phone}\nStatus: ${staffMember.status}`);
            }
        }

        function printReport() {
            window.print();
        }

        function exportReport() {
            alert('Export to CSV feature will be added in the next update!');
        }

        function printInvoice(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (request) {
                alert(`Invoice for ${request.id}\n\nClient: ${request.clientName}\nService: ${formatServiceType(request.serviceType)}\nAmount: KES ${request.serviceCost.toLocaleString()}\nStatus: ${request.invoiceStatus}`);
            }
        }

        function deleteRequest(requestId) {
            if (confirm('Are you sure you want to delete this request? This action cannot be undone.')) {
                const index = requests.findIndex(r => r.id === requestId);
                if (index > -1) {
                    requests.splice(index, 1);
                    saveData();
                    alert('Request deleted successfully!');
                    displayAllRequests();
                    updateDashboard();
                }
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è WARNING: This will delete ALL data including requests, vehicles, and staff. Are you absolutely sure?')) {
                if (confirm('This action CANNOT be undone. Click OK to proceed.')) {
                    localStorage.clear();
                    requests = [];
                    vehicles = [];
                    staff = [];
                    requestIdCounter = 1001;
                    vehicleIdCounter = 1;
                    staffIdCounter = 1;
                    alert('All data has been cleared!');
                    location.reload();
                }
            }
        }

        function formatServiceType(type) {
            const types = {
                'delivery': 'Delivery/Courier',
                'security': 'Security Guard',
                'transport': 'Staff Transport',
                'pickup': 'Pickup Service',
                'escort': 'Security Escort'
            };
            return types[type] || type;
        }
    </script>
</body>
</html>
